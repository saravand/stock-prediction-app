<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stock Price Predictor</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <style>
    :root {
      --bg-dark: #0a0e1a;
      --bg-card: #131825;
      --bg-input: #1a1f33;
      --accent-primary: #00d4aa;
      --accent-secondary: #7b61ff;
      --text-primary: #e8edf4;
      --text-secondary: #8b95a8;
      --border: rgba(255, 255, 255, 0.08);
      --shadow: rgba(0, 0, 0, 0.4);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Manrope', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(123, 97, 255, 0.15) 0%, transparent 60%);
      pointer-events: none;
      animation: float 20s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(-30px, 40px) rotate(5deg); }
      66% { transform: translate(30px, -30px) rotate(-5deg); }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
      position: relative;
      z-index: 1;
    }

    header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInDown 0.8s ease-out;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h1 {
      font-family: 'DM Serif Display', serif;
      font-size: 3.5rem;
      font-weight: 400;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      font-weight: 400;
      letter-spacing: 0.02em;
    }

    .search-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 60px var(--shadow);
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .input-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    input {
      flex: 1;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      color: var(--text-primary);
      font-family: 'Manrope', sans-serif;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
      background: var(--bg-card);
    }

    input::placeholder {
      color: var(--text-secondary);
      text-transform: none;
      letter-spacing: normal;
    }

    button {
      background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
      border: none;
      border-radius: 12px;
      padding: 1rem 2.5rem;
      color: white;
      font-family: 'Manrope', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      letter-spacing: 0.02em;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(0, 212, 170, 0.3);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .info-text {
      color: var(--text-secondary);
      font-size: 0.9rem;
      text-align: center;
      font-weight: 400;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
      animation: fadeInUp 0.8s ease-out 0.4s both;
    }

    .prediction-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .prediction-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.5s ease;
    }

    .prediction-card:hover::before {
      transform: scaleX(1);
    }

    .prediction-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px var(--shadow);
      border-color: rgba(0, 212, 170, 0.3);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .period {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .change-badge {
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .change-badge.positive {
      background: rgba(0, 212, 170, 0.15);
      color: var(--accent-primary);
    }

    .change-badge.negative {
      background: rgba(255, 82, 82, 0.15);
      color: #ff5252;
    }

    .price {
      font-family: 'DM Serif Display', serif;
      font-size: 2.5rem;
      font-weight: 400;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
    }

    .price-details {
      display: flex;
      gap: 1.5rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .detail-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 500;
    }

    .detail-value {
      font-weight: 600;
      color: var(--text-primary);
    }

    .chart-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 2.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 20px 60px var(--shadow);
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }

    .chart-header {
      margin-bottom: 2rem;
    }

    .chart-title {
      font-family: 'DM Serif Display', serif;
      font-size: 1.8rem;
      font-weight: 400;
      margin-bottom: 0.5rem;
      letter-spacing: -0.01em;
    }

    .chart-subtitle {
      color: var(--text-secondary);
      font-size: 0.95rem;
      font-weight: 400;
    }

    canvas {
      max-height: 400px;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 3px solid var(--border);
      border-top: 3px solid var(--accent-primary);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error {
      background: rgba(255, 82, 82, 0.1);
      border: 1px solid rgba(255, 82, 82, 0.3);
      border-radius: 12px;
      padding: 1.5rem;
      color: #ff5252;
      text-align: center;
      margin-top: 1rem;
      display: none;
      font-weight: 500;
    }

    .error.active {
      display: block;
    }

    .disclaimer {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2rem;
      margin-top: 2rem;
      text-align: center;
      animation: fadeInUp 0.8s ease-out 0.8s both;
    }

    .disclaimer-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .disclaimer-text {
      color: var(--text-secondary);
      font-size: 0.85rem;
      line-height: 1.6;
      font-weight: 400;
    }

    #results {
      display: none;
    }

    #results.active {
      display: block;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 2.5rem;
      }

      .input-group {
        flex-direction: column;
      }

      button {
        width: 100%;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Stock Price Predictor</h1>
      <p class="subtitle">AI-powered forecasting for informed investment decisions</p>
    </header>

    <div class="search-section">
      <div class="input-group">
        <input 
          type="text" 
          id="apiKeyInput" 
          placeholder="Alpha Vantage API Key (get free at alphavantage.co)" 
          autocomplete="off"
          style="flex: 2;"
        >
        <input 
          type="text" 
          id="tickerInput" 
          placeholder="Stock Ticker (e.g., AAPL)" 
          autocomplete="off"
          style="flex: 1;"
        >
        <button id="predictBtn" onclick="predictStock()">Generate Forecast</button>
      </div>
      <p class="info-text">Get your free API key at <a href="https://www.alphavantage.co/support/#api-key" target="_blank" style="color: var(--accent-primary); text-decoration: none;">alphavantage.co</a> ‚Ä¢ Enter any US stock ticker</p>
      <div class="error" id="errorMsg"></div>
    </div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <p style="font-weight: 600; margin-bottom: 0.5rem;">Analyzing market data...</p>
      <p style="font-size: 0.9rem; color: var(--text-secondary);">
        Fetching real-time news ‚Ä¢ Analyzing earnings reports ‚Ä¢ Checking analyst ratings ‚Ä¢ Generating predictions
      </p>
    </div>

    <div id="results">
      <div class="results-grid" id="predictionCards"></div>

      <div class="chart-section">
        <div class="chart-header">
          <h2 class="chart-title">Price Trajectory</h2>
          <p class="chart-subtitle">Projected price movement over the next 12 months</p>
        </div>
        <canvas id="priceChart"></canvas>
      </div>

      <div class="disclaimer">
        <div class="disclaimer-title">‚ö†Ô∏è Investment Disclaimer</div>
        <p class="disclaimer-text">
          These predictions are AI-generated estimates based on analysis and should not be considered financial advice. 
          Stock prices are influenced by countless factors and actual results may differ significantly. 
          Always conduct your own research and consult with a financial advisor before making investment decisions.
        </p>
      </div>
    </div>
  </div>

  <script>
    let chart = null;

    // Get real-time stock price from Alpha Vantage
    async function getCurrentPrice(ticker, apiKey) {
      try {
        const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${ticker}&apikey=${apiKey}`;
        const response = await fetch(url);
        const data = await response.json();
        
        if (data['Global Quote'] && data['Global Quote']['05. price']) {
          return parseFloat(data['Global Quote']['05. price']);
        } else if (data['Note']) {
          throw new Error('API call limit reached. Please wait a moment and try again.');
        } else if (data['Error Message']) {
          throw new Error('Invalid stock ticker. Please check and try again.');
        } else {
          throw new Error('Unable to fetch stock price. Please verify the ticker symbol.');
        }
      } catch (error) {
        throw error;
      }
    }

    async function predictStock() {
      const ticker = document.getElementById('tickerInput').value.trim().toUpperCase();
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      const errorMsg = document.getElementById('errorMsg');
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      const predictBtn = document.getElementById('predictBtn');

      // Validation
      if (!apiKey) {
        showError('Please enter your Alpha Vantage API key');
        return;
      }

      if (!ticker) {
        showError('Please enter a stock ticker');
        return;
      }

      if (!/^[A-Z]{1,5}$/.test(ticker)) {
        showError('Please enter a valid stock ticker (1-5 letters)');
        return;
      }

      // Reset UI
      errorMsg.classList.remove('active');
      results.classList.remove('active');
      loading.classList.add('active');
      predictBtn.disabled = true;

      try {
        // Get current price from Alpha Vantage
        const currentPrice = await getCurrentPrice(ticker, apiKey);

        // Call Claude API for predictions
        const predictions = await generatePredictions(ticker, currentPrice);

        // Display results
        displayResults(ticker, currentPrice, predictions);
        
        loading.classList.remove('active');
        results.classList.add('active');
      } catch (error) {
        loading.classList.remove('active');
        showError(error.message || 'Failed to generate predictions. Please try again.');
        console.error(error);
      } finally {
        predictBtn.disabled = false;
      }
    }

    async function generatePredictions(ticker, currentPrice) {
      try {
        // First, gather real-time market intelligence
        const marketIntel = await gatherMarketIntelligence(ticker);
        
        // Then generate predictions with that context
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 1500,
            tools: [{
              type: "web_search_20250305",
              name: "web_search"
            }],
            messages: [{
              role: 'user',
              content: `You are a financial analyst. Analyze ${ticker} stock and provide price predictions for 3 months, 6 months, 9 months, and 1 year.

Current price: $${currentPrice.toFixed(2)}

CRITICAL: Before making predictions, use the web_search tool to research:
1. Recent news about ${ticker}
2. Latest earnings reports
3. Recent company announcements
4. Analyst ratings and price targets
5. Industry trends and competitor performance

After gathering this information, provide realistic predictions that account for:
- Recent news and events
- Earnings performance and guidance
- Market sentiment
- Technical and fundamental analysis
- Industry headwinds/tailwinds

Respond ONLY with a JSON object in this exact format (no markdown, no backticks, no other text):
{
  "3mo": {"price": number, "change": number, "confidence": "high|medium|low", "reasoning": "brief 1-sentence rationale"},
  "6mo": {"price": number, "change": number, "confidence": "high|medium|low", "reasoning": "brief 1-sentence rationale"},
  "9mo": {"price": number, "change": number, "confidence": "high|medium|low", "reasoning": "brief 1-sentence rationale"},
  "1yr": {"price": number, "change": number, "confidence": "high|medium|low", "reasoning": "brief 1-sentence rationale"},
  "marketContext": "2-3 sentence summary of key factors influencing predictions"
}

Make sure all prices are realistic given the current market conditions you researched.`
            }]
          })
        });

        const data = await response.json();
        
        // Extract text from all content blocks (may include tool use results)
        let fullText = '';
        if (data.content) {
          for (const block of data.content) {
            if (block.type === 'text') {
              fullText += block.text;
            }
          }
        }
        
        // Remove any markdown formatting if present
        const jsonStr = fullText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
        const predictions = JSON.parse(jsonStr);
        
        return predictions;
      } catch (error) {
        console.error('API Error:', error);
        // Fallback to simulated predictions if API fails
        return generateFallbackPredictions(currentPrice);
      }
    }

    async function gatherMarketIntelligence(ticker) {
      // This function would ideally call news APIs
      // For now, it serves as a placeholder for future enhancement
      return {
        hasRecentNews: true,
        timestamp: new Date().toISOString()
      };
    }

    function generateFallbackPredictions(currentPrice) {
      // Generate realistic-looking predictions as fallback
      const volatility = 0.15 + Math.random() * 0.25;
      
      const predictions = {};
      const periods = ['3mo', '6mo', '9mo', '1yr'];
      const months = [3, 6, 9, 12];
      
      periods.forEach((period, idx) => {
        const drift = (Math.random() - 0.3) * 0.1 * months[idx];
        const randomWalk = (Math.random() - 0.5) * volatility * Math.sqrt(months[idx] / 12);
        const changePercent = (drift + randomWalk) * 100;
        const predictedPrice = currentPrice * (1 + changePercent / 100);
        
        predictions[period] = {
          price: parseFloat(predictedPrice.toFixed(2)),
          change: parseFloat(changePercent.toFixed(2)),
          confidence: Math.abs(changePercent) < 10 ? 'high' : Math.abs(changePercent) < 20 ? 'medium' : 'low',
          reasoning: 'Prediction based on historical volatility patterns (offline mode)'
        };
      });
      
      predictions.marketContext = 'Unable to fetch real-time market data. Predictions are based on statistical models and historical patterns only.';
      
      return predictions;
    }

    function displayResults(ticker, currentPrice, predictions) {
      const cardsContainer = document.getElementById('predictionCards');
      cardsContainer.innerHTML = '';

      // Add current price card first
      const currentCard = document.createElement('div');
      currentCard.className = 'prediction-card';
      currentCard.style.background = 'linear-gradient(135deg, rgba(0, 212, 170, 0.1), rgba(123, 97, 255, 0.1))';
      currentCard.innerHTML = `
        <div class="card-header">
          <span class="period">CURRENT PRICE</span>
          <span class="change-badge positive" style="background: rgba(0, 212, 170, 0.2);">
            ‚óè LIVE
          </span>
        </div>
        <div class="price">$${currentPrice.toFixed(2)}</div>
        <div class="price-details">
          <div class="detail-item">
            <span class="detail-label">Ticker</span>
            <span class="detail-value">${ticker}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Source</span>
            <span class="detail-value">ALPHA VANTAGE</span>
          </div>
        </div>
      `;
      cardsContainer.appendChild(currentCard);

      const periods = [
        { key: '3mo', label: '3 Months' },
        { key: '6mo', label: '6 Months' },
        { key: '9mo', label: '9 Months' },
        { key: '1yr', label: '1 Year' }
      ];

      periods.forEach(({ key, label }) => {
        const pred = predictions[key];
        const isPositive = pred.change >= 0;
        
        const card = document.createElement('div');
        card.className = 'prediction-card';
        card.innerHTML = `
          <div class="card-header">
            <span class="period">${label}</span>
            <span class="change-badge ${isPositive ? 'positive' : 'negative'}">
              ${isPositive ? '‚Üë' : '‚Üì'} ${Math.abs(pred.change).toFixed(2)}%
            </span>
          </div>
          <div class="price">$${pred.price.toFixed(2)}</div>
          <div class="price-details">
            <div class="detail-item">
              <span class="detail-label">From Current</span>
              <span class="detail-value">${isPositive ? '+' : ''}$${(pred.price - currentPrice).toFixed(2)}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Confidence</span>
              <span class="detail-value">${pred.confidence.toUpperCase()}</span>
            </div>
          </div>
          ${pred.reasoning ? `<div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5;">${pred.reasoning}</div>` : ''}
        `;
        cardsContainer.appendChild(card);
      });

      // Add market context section if available
      if (predictions.marketContext) {
        const contextCard = document.createElement('div');
        contextCard.style.gridColumn = '1 / -1';
        contextCard.style.background = 'var(--bg-card)';
        contextCard.style.border = '1px solid var(--border)';
        contextCard.style.borderRadius = '16px';
        contextCard.style.padding = '2rem';
        contextCard.style.marginTop = '1rem';
        contextCard.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
            <span style="font-size: 1.5rem;">üìä</span>
            <h3 style="font-family: 'DM Serif Display', serif; font-size: 1.3rem; font-weight: 400;">Market Context</h3>
          </div>
          <p style="color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem;">${predictions.marketContext}</p>
          <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border); font-size: 0.8rem; color: var(--text-secondary); font-style: italic;">
            Analysis based on real-time market research conducted on ${new Date().toLocaleDateString()}
          </div>
        `;
        cardsContainer.appendChild(contextCard);
      }

      // Create chart
      createChart(ticker, currentPrice, predictions);
    }

    function createChart(ticker, currentPrice, predictions) {
      const ctx = document.getElementById('priceChart').getContext('2d');
      
      if (chart) {
        chart.destroy();
      }

      const labels = ['Current', '3 Months', '6 Months', '9 Months', '1 Year'];
      const dataPoints = [
        currentPrice,
        predictions['3mo'].price,
        predictions['6mo'].price,
        predictions['9mo'].price,
        predictions['1yr'].price
      ];

      const gradient = ctx.createLinearGradient(0, 0, 0, 400);
      gradient.addColorStop(0, 'rgba(0, 212, 170, 0.3)');
      gradient.addColorStop(1, 'rgba(0, 212, 170, 0)');

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: `${ticker} Price Forecast`,
            data: dataPoints,
            borderColor: '#00d4aa',
            backgroundColor: gradient,
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 6,
            pointBackgroundColor: '#00d4aa',
            pointBorderColor: '#0a0e1a',
            pointBorderWidth: 2,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: '#131825',
              titleColor: '#e8edf4',
              bodyColor: '#8b95a8',
              borderColor: 'rgba(255, 255, 255, 0.08)',
              borderWidth: 1,
              padding: 12,
              displayColors: false,
              callbacks: {
                label: function(context) {
                  return `$${context.parsed.y.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: false,
              grid: {
                color: 'rgba(255, 255, 255, 0.05)',
                drawBorder: false
              },
              ticks: {
                color: '#8b95a8',
                callback: function(value) {
                  return '$' + value.toFixed(0);
                }
              }
            },
            x: {
              grid: {
                display: false,
                drawBorder: false
              },
              ticks: {
                color: '#8b95a8'
              }
            }
          },
          interaction: {
            intersect: false,
            mode: 'index'
          }
        }
      });
    }

    function showError(message) {
      const errorMsg = document.getElementById('errorMsg');
      errorMsg.textContent = message;
      errorMsg.classList.add('active');
      setTimeout(() => {
        errorMsg.classList.remove('active');
      }, 5000);
    }

    // Allow Enter key to submit
    document.getElementById('tickerInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        predictStock();
      }
    });
  </script>
</body>
</html>
